<?xml version="1.0" encoding="utf-8"?>
<launch>
  <arg name="scan_topic"  default="scan" />
  <arg name="base_frame"  default="base_footprint"/>
  <arg name="odom_frame"  default="odom"/>
  <arg name="output" default="log"/>
  <arg name="robot_name" default="cabot2-gtm"/>
  
  <include file="$(find velodyne_pointcloud)/launch/VLP16_points.launch"/>
  
  <group if="$(eval robot_name=='cabot2-gtm')">
    <include file="$(find cabot)/launch/cabot2-gtm-remote.launch"/>
    <include file="$(find cabot_description)/launch/rviz_test.launch">
      <arg name="robot" value="cabot2-gtm"/>
      <arg name="use_rviz" value="false"/>
    </include>
  </group>
  
  <group if="$(eval robot_name=='cabot2-gtm-outdoor')">
    <include file="$(find cabot)/launch/cabot2-gtm-outdoor-remote.launch"/>
    <include file="$(find cabot_description)/launch/rviz_test.launch">
      <arg name="robot" value="cabot2-gtm-outdoor"/>
      <arg name="use_rviz" value="false"/>
    </include>
  </group>
  
  <node pkg="nodelet" type="nodelet" output="$(arg output)" name="odom_adapter_nodelet"
	  args="load Safety/OdomAdapterNodelet cabot_nodelet_manager">
    <param name="odom_input" value="/odom_raw"/>
    <param name="odom_output" value="/odom"/>
    <param name="odom_frame" value="odom"/>
    <param name="base_frame" value="base_footprint"/>
    <param name="offset_frame" value="base_control_shift"/>
    <param name="publish_tf" value="true"/>
    <param name="max_speed" value="1.2" />
      
    <param name="cmd_vel_input" value="/cabot/cmd_vel_limited"/>
    <param name="cmd_vel_output" value="/cabot/cmd_vel"/>
      
    <param name="target_rate" value="20"/>
  </node>

  <node pkg="gmapping" type="slam_gmapping" name="slam_gmapping" output="screen">
    <param name="base_frame" value="$(arg base_frame)"/>
    <param name="odom_frame" value="$(arg odom_frame)"/>
    <param name="sigma" value="0.01"/>
    <param name="lsigma" value="0.01"/>
    <remap from="scan" to="$(arg scan_topic)"/>
  </node>
  
  <node name="rviz" pkg="rviz" type="rviz" args="-d $(find cabot_gmapping)/rviz/gmapping.rviz" />
  
  <!-- <node pkg="tf" type="static_transform_publisher" name="odom_base_footprint"
	  args="0 0 0 0 0 0 1  odom base_footprint  100"/> -->
</launch>
